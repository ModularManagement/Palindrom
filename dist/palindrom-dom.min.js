/*! Palindrom, version: 6.2.0 */
var PalindromDOM=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return o});class r extends Error{constructor(t){super(t),this.message=t}}class o extends r{constructor(t,e,n,r){if(!e||!["Server","Client"].includes(e))throw new TypeError("Error constructing PalindromConnectionError, `side` parameter is required and can either be 'Server' or 'Client'");super(t),this.side=e,this.message=`${e} error\n\t${t.replace(/\n/g,"\n\t")}`,this.url=n,this.connectionType=r}}},function(t,e){t.exports=null},function(t,e){t.exports=WebSocket},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4);
/*! Palindrom
 * https://github.com/Palindrom/Palindrom
 * (c) 2017 Joachim Wester
 * MIT license
 */
function o(t,e){var n;e?(n=Object(r.resolve)(e,t),n=Object(r.parse)(n)):n=Object(r.parse)(t),Object.assign(this,n)}},function(t,e,n){"use strict";var r=n(12),o=n(14);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=g,e.resolve=function(t,e){return g(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?g(t,!1,!0).resolveObject(e):e},e.format=function(t){o.isString(t)&&(t=g(t));return t instanceof s?t.format():s.prototype.format.call(t)},e.Url=s;var i=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),u=["%","/","?",";","#"].concat(l),p=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(15);function g(t,e,n){if(t&&o.isObject(t)&&t instanceof s)return t;var r=new s;return r.parse(t,e,n),r}s.prototype.parse=function(t,e,n){if(!o.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),a=-1!==s&&s<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var g=t=c.join(a);if(g=g.trim(),!n&&1===t.split("#").length){var w=h.exec(g);if(w)return this.path=g,this.href=g,this.pathname=w[1],w[2]?(this.search=w[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var S=i.exec(g);if(S){var j=(S=S[0]).toLowerCase();this.protocol=j,g=g.substr(S.length)}if(n||S||g.match(/^\/\/[^@\/]+@[^@\/]+/)){var P="//"===g.substr(0,2);!P||S&&v[S]||(g=g.substr(2),this.slashes=!0)}if(!v[S]&&(P||S&&!b[S])){for(var O,_,x=-1,E=0;E<p.length;E++){-1!==(C=g.indexOf(p[E]))&&(-1===x||C<x)&&(x=C)}-1!==(_=-1===x?g.lastIndexOf("@"):g.lastIndexOf("@",x))&&(O=g.slice(0,_),g=g.slice(_+1),this.auth=decodeURIComponent(O)),x=-1;for(E=0;E<u.length;E++){var C;-1!==(C=g.indexOf(u[E]))&&(-1===x||C<x)&&(x=C)}-1===x&&(x=g.length),this.host=g.slice(0,x),g=g.slice(x),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var R=this.hostname.split(/\./),k=(E=0,R.length);E<k;E++){var U=R[E];if(U&&!U.match(d)){for(var A="",N=0,I=U.length;N<I;N++)U.charCodeAt(N)>127?A+="x":A+=U[N];if(!A.match(d)){var q=R.slice(0,E),M=R.slice(E+1),H=U.match(f);H&&(q.push(H[1]),M.unshift(H[2])),M.length&&(g="/"+M.join(".")+g),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=r.toASCII(this.hostname));var W=this.port?":"+this.port:"",L=this.hostname||"";this.host=L+W,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==g[0]&&(g="/"+g))}if(!m[j])for(E=0,k=l.length;E<k;E++){var V=l[E];if(-1!==g.indexOf(V)){var J=encodeURIComponent(V);J===V&&(J=escape(V)),g=g.split(V).join(J)}}var F=g.indexOf("#");-1!==F&&(this.hash=g.substr(F),g=g.slice(0,F));var D=g.indexOf("?");if(-1!==D?(this.search=g.substr(D),this.query=g.substr(D+1),e&&(this.query=y.parse(this.query)),g=g.slice(0,D)):e&&(this.search="",this.query={}),g&&(this.pathname=g),b[j]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){W=this.pathname||"";var $=this.search||"";this.path=W+$}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=!1,i="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(i=y.stringify(this.query));var a=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||b[e])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+s+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+r},s.prototype.resolve=function(t){return this.resolveObject(g(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if(o.isString(t)){var e=new s;e.parse(t,!1,!0),t=e}for(var n=new s,r=Object.keys(this),i=0;i<r.length;i++){var a=r[i];n[a]=this[a]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),c=0;c<h.length;c++){var l=h[c];"protocol"!==l&&(n[l]=t[l])}return b[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!b[t.protocol]){for(var u=Object.keys(t),p=0;p<u.length;p++){var d=u[p];n[d]=t[d]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||v[t.protocol])n.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var g=n.pathname&&"/"===n.pathname.charAt(0),w=t.host||t.pathname&&"/"===t.pathname.charAt(0),S=w||g||n.host&&t.pathname,j=S,P=n.pathname&&n.pathname.split("/")||[],O=(f=t.pathname&&t.pathname.split("/")||[],n.protocol&&!b[n.protocol]);if(O&&(n.hostname="",n.port=null,n.host&&(""===P[0]?P[0]=n.host:P.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),S=S&&(""===f[0]||""===P[0])),w)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,P=f;else if(f.length)P||(P=[]),P.pop(),P=P.concat(f),n.search=t.search,n.query=t.query;else if(!o.isNullOrUndefined(t.search)){if(O)n.hostname=n.host=P.shift(),(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift());return n.search=t.search,n.query=t.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!P.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var _=P.slice(-1)[0],x=(n.host||t.host||P.length>1)&&("."===_||".."===_)||""===_,E=0,C=P.length;C>=0;C--)"."===(_=P[C])?P.splice(C,1):".."===_?(P.splice(C,1),E++):E&&(P.splice(C,1),E--);if(!S&&!j)for(;E--;E)P.unshift("..");!S||""===P[0]||P[0]&&"/"===P[0].charAt(0)||P.unshift(""),x&&"/"!==P.join("/").substr(-1)&&P.push("");var T,R=""===P[0]||P[0]&&"/"===P[0].charAt(0);O&&(n.hostname=n.host=R?"":P.length?P.shift():"",(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.host=n.hostname=T.shift()));return(S=S||n.host&&P.length)&&!R&&P.unshift(""),P.length?n.pathname=P.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},s.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return i});var r=n(0);const o="Client";function s(t,e,n,s){let i,a;this.start=function(){i||(i=setTimeout(()=>{this.notifySend(),t()},n))},this.notifySend=function(){clearTimeout(i),i=null,a||(a=setTimeout(()=>{a=null,e(new r.a("Timeout has passed and response hasn't arrived",o,this.remoteUrl,"Unknown"))},s))},this.notifyReceive=function(){clearTimeout(a),a=null,this.start()},this.stop=()=>{clearTimeout(i),i=null,clearTimeout(a),a=null}}function i(){this.start=this.stop=this.notifySend=this.notifyReceive=()=>{}}},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return d});var r=n(3),o=n(0),s=n(6),i=n(2),a=n.n(i),h=n(1),c=n.n(h);const l="Client",u="Server";function p(t){return t.replace(/^http/i,"ws")}class d{constructor(t,e,n,o,i,a,h,c,l){if(this.palindrom=t,"undefined"!=typeof window&&window.location?this.remoteUrl=new r.a(e,window.location.href):this.remoteUrl=new r.a(e),o&&(this.onReceive=o),i&&(this.onSend=i),a&&(this.onConnectionError=a),c&&(this.onStateChange=c),h&&(this.onSocketOpened=h),Object.defineProperty(this,"useWebSocket",{get:function(){return n},set:t=>(n=t,0==t?this._ws&&(this._ws.onclose=function(){this._ws=null},this._ws.close()):this.wsUrl||(this.wsUrl=p(this.remoteUrl.href)),n)}),l){const t=1e3*l;this.heartbeat=new s.a(()=>{this.send([])},this._handleConnectionError.bind(this),t,t)}else this.heartbeat=new s.b}async _establish(t=null){this.heartbeat.stop();const e=t?await this._fetch("PATCH",this.remoteUrl.href+"/reconnect","application/json",JSON.stringify(t)):await this._fetch("GET",this.remoteUrl.href,"application/json",null);return this.useWebSocket&&this.webSocketUpgrade(this.onSocketOpened),this.heartbeat.start(),e}_handleConnectionError(t){this.heartbeat.stop(),this.palindrom.reconnector.triggerReconnection(),this.onConnectionError(t)}_handleFatalError(t){this.heartbeat.stop(),this.palindrom.reconnector.stopReconnecting(),this.onConnectionError(t)}_notifyReceive(){this.heartbeat.notifyReceive(),this.onReceive(...arguments)}async send(t){this.heartbeat.notifySend();const e=JSON.stringify(t);if(this.useWebSocket&&this._ws&&1===this._ws.readyState)this._ws.send(e),this.onSend(e,this._ws.url,"WS");else{const t=this.remoteUrl.href,n="PATCH",r=await this._fetch(n,t,"application/json-patch+json",e);this._notifyReceive(r,t,n)}return this}onReceive(){}onSend(){}onStateChange(){}upgrade(t){}webSocketUpgrade(t){this.wsUrl=p(this.remoteUrl.href);const e=this.wsUrl;this.closeConnection();const n=a.a.w3cwebsocket||a.a;this._ws=new n(e),this._ws.onopen=n=>{this.onStateChange(this._ws.readyState,e),t&&t(n)},this._ws.onmessage=t=>{try{var e=JSON.parse(t.data)}catch(e){return void this._handleFatalError(new o.a(t.data,u,this._ws.url,"WS"))}this._notifyReceive(e,this._ws.url,"WS")},this._ws.onerror=t=>{if(this.onStateChange(this._ws.readyState,e,t.data),!this.useWebSocket)return;const n=["WebSocket connection could not be made","readyState: "+this._ws.readyState].join("\n");this._handleFatalError(new o.a(n,l,e,"WS"))},this._ws.onclose=t=>{this.onStateChange(this._ws.readyState,e,null,t.code,t.reason);const n=["WebSocket connection closed unexpectedly.","reason: "+t.reason,"readyState: "+this._ws.readyState,"stateCode: "+t.code].join("\n");t.reason?this._handleFatalError(new o.a(n,u,e,"WS")):t.wasClean||this._handleConnectionError(new o.a(n,u,e,"WS"))}}closeConnection(){this._ws&&(this._ws.onclose=()=>{},this._ws.close(),this._ws=null)}async getPatchUsingHTTP(t){const e=await this._fetch("GET",t,"application/json-patch+json",null,!0);return this._notifyReceive(e,t,"GET"),e}_setRemoteUrl(t){if(this.remoteUrlSet&&this.remoteUrl&&this.remoteUrl!=t){const e=["Session lost.","Server replied with a different session ID than the already set one.","Possibly a server restart happened while you were working.","Please reload the page.","Previous session ID: "+this.remoteUrl,"New session ID: "+t].join("\n");throw new o.b(e)}this.remoteUrlSet=!0,this.remoteUrl=new r.a(t,this.remoteUrl.href)}_handleLocationHeader(t){const e=t.headers.get("x-location")||t.headers.get("location");e&&this._setRemoteUrl(e)}async _handleFailureResponse(t,e,n){var r=`An unknown network error has occurred. Raw message: ${n.message}`;console.error(n);const s=[r,"statusCode: -1","reason: Maybe you lost connection with the server","url: "+t,"HTTP method: "+e].join("\n");this._handleFatalError(new o.a(s,l,t,e))}async _fetch(e,n,r,o,s){const i={headers:{},method:e,credentials:"include"},a=i.headers;o&&(a["Content-Type"]="application/json-patch+json",i.body=o),r&&(a.Accept=r),this.remoteUrl&&s&&(a["X-Referer"]=this.remoteUrl.pathname),this.onSend(o,n,e);let h=void 0!==t&&t.fetch||c.a;const l=await h(n,i);return l.json().then(t=>{if(l.status<500)return this._handleLocationHeader(l),t;throw new Error(`HTTP ${l.status} response: response body is ${JSON.stringify(t)}`)}).catch(t=>{throw this._handleFailureResponse(n,e,t),t})}}}).call(this,n(5))},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return l});n(3);var r=n(0),o=n(2),s=n.n(o),i=n(1),a=n.n(i);const h="Client",c="Server";class l{constructor(t,e,n,r,o,s,i,a,h,c){this.palindrom=t,this.wsServer=h,this.httpServer=c,r&&(this.onReceive=r),o&&(this.onSend=o),s&&(this.onConnectionError=s),a&&(this.onStateChange=a),i&&(this.onSocketOpened=i),Object.defineProperty(this,"useWebSocket",{get:function(){return n},set:t=>(n=t,0==t?this._ws&&(this._ws.onclose=function(){this._ws=null},this._ws.close()):this.wsUrl,n)})}_establish(t=null,e){return this.useWebSocket&&this.webSocketUpgrade(this.onSocketOpened),e}_handleConnectionError(t){this.onConnectionError(t)}_handleFatalError(t){this.onConnectionError(t)}async send(t){const e=JSON.stringify(t);return this.useWebSocket&&this._ws&&1===this._ws.readyState&&(this._ws.send(e),this.onSend(e,this._ws.url,"WS")),this}onReceive(){}onSend(){}onStateChange(){}upgrade(t){}webSocketUpgrade(t){const e=this.wsUrl;this.closeConnection();s.a.w3cwebsocket||s.a;this.wsServer.on("connection",(n,o)=>{this._ws=n,n.protocol="Palindrom.6.1",this.onStateChange(n.readyState,e),t&&t(n,o),n.onmessage=t=>{try{var e=JSON.parse(t.data)}catch(e){return void this._handleFatalError(new r.a(t.data,c,n.url,"WS"))}this.onReceive(e,n.url,"WS")},n.onerror=t=>{if(this.onStateChange(n.readyState,e,t.data),!this.useWebSocket)return;const o=["WebSocket connection could not be made","readyState: "+n.readyState].join("\n");this._handleFatalError(new r.a(o,h,e,"WS"))},n.onclose=t=>{this.onStateChange(this._ws.readyState,e,null,t.code,t.reason);const n=["WebSocket connection closed unexpectedly.","reason: "+t.reason,"readyState: "+this._ws.readyState,"stateCode: "+t.code].join("\n");t.reason?this._handleFatalError(new r.a(n,c,e,"WS")):t.wasClean||this._handleConnectionError(new r.a(n,c,e,"WS"))}})}closeConnection(){this._ws&&(this._ws.onclose=()=>{},this._ws.close(),this._ws=null)}async getPatchUsingHTTP(t){const e=await this._fetch("GET",t,"application/json-patch+json",null,!0);return this.onReceive(e,t,"GET"),e}_setRemoteUrl(t){if(this.remoteUrlSet&&this.remoteUrl&&this.remoteUrl!=t){const e=["Session lost.","Server replied with a different session ID than the already set one.","Possibly a server restart happened while you were working.","Please reload the page.","Previous session ID: "+this.remoteUrl,"New session ID: "+t].join("\n");throw new r.b(e)}this.remoteUrlSet=!0}_handleLocationHeader(t){const e=t.headers.get("x-location")||t.headers.get("location");e&&this._setRemoteUrl(e)}async _handleFailureResponse(t,e,n){var o=`An unknown network error has occurred. Raw message: ${n.message}`;console.error(n);const s=[o,"statusCode: -1","reason: Maybe you lost connection with the server","url: "+t,"HTTP method: "+e].join("\n");this.onFatalError(new r.a(s,h,t,e))}async _fetch(e,n,r,o,s){const i={headers:{},method:e,credentials:"include"},h=i.headers;o&&(h["Content-Type"]="application/json-patch+json",i.body=o),r&&(h.Accept=r),this.remoteUrl&&s&&(h["X-Referer"]=this.remoteUrl.pathname),this.onSend(o,n,e);let c=void 0!==t&&t.fetch||a.a;const l=await c(n,i);return l.json().then(t=>{if(l.status<500)return this._handleLocationHeader(l),t;throw new Error(`HTTP ${l.status} response: response body is ${JSON.stringify(t)}`)}).catch(t=>{throw this._handleFailureResponse(n,e,t),t})}}}).call(this,n(5))},function(t,e,n){"use strict";
/*!
 * https://github.com/Palindrom/JSONPatcherProxy
 * (c) 2017 Starcounter 
 * MIT license
 */const r=function(){function t(t){return-1==t.indexOf("/")&&-1==t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function e(t,e){const n=[];let r=t.parenthoodMap.get(e);for(;r&&r.path;)n.unshift(r.path),r=t.parenthoodMap.get(r.parent);if(n.length){return"/"+n.join("/")}return""}function n(t,e){this.isProxifyingTreeNow=!1,this.isObserving=!1,this.proxifiedObjectsMap=new Map,this.parenthoodMap=new Map,"boolean"!=typeof e&&(e=!0),this.showDetachedWarning=e,this.originalObject=t,this.cachedProxy=null,this.isRecording=!1,this.userCallback,this.resume=function(){this.defaultCallback=t=>{this.isRecording&&this.patches.push(t),this.userCallback&&this.userCallback(t)},this.isObserving=!0}.bind(this),this.pause=function(){this.defaultCallback=()=>{},this.isObserving=!1}.bind(this)}return n.deepClone=function(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}},n.escapePathComponent=t,n.prototype.generateProxyAtPath=function(n,r,o){if(!r)return r;const s={set:(n,r,o,s)=>(function(n,r,o,s){const i=e(n,r)+"/"+t(o);if(n.proxifiedObjectsMap.has(s)){const t=n.proxifiedObjectsMap.get(s);n.parenthoodMap.set(t.originalObject,{parent:r,path:o})}const a=n.proxifiedObjectsMap.get(s);a&&!n.isProxifyingTreeNow&&(a.inherited=!0),s&&"object"==typeof s&&!n.proxifiedObjectsMap.has(s)&&(n.parenthoodMap.set(s,{parent:r,path:o}),s=n._proxifyObjectTreeRecursively(r,s,o));const h={op:"remove",path:i};if(void 0===s){if(!Array.isArray(r)&&!r.hasOwnProperty(o))return Reflect.set(r,o,s);{Array.isArray(r)&&(h.op="replace",h.value=null);const t=n.proxifiedObjectsMap.get(r[o]);t&&(n.parenthoodMap.delete(r[o]),n.disableTrapsForProxy(t),n.proxifiedObjectsMap.delete(t))}}else{if(Array.isArray(r)&&!Number.isInteger(+o.toString()))return"length"!=o&&console.warn("JSONPatcherProxy noticed a non-integer prop was set for an array. This will not emit a patch"),Reflect.set(r,o,s);h.op="add",r.hasOwnProperty(o)&&(void 0!==r[o]||Array.isArray(r))&&(h.op="replace"),h.value=s}const c=Reflect.set(r,o,s);return n.defaultCallback(h),c})(this,n,r,o),deleteProperty:(n,r)=>(function(n,r,o){if(void 0!==r[o]){const s=e(n,r)+"/"+t(o),i=n.proxifiedObjectsMap.get(r[o]);i&&(i.inherited?i.inherited=!1:(n.parenthoodMap.delete(i.originalObject),n.disableTrapsForProxy(i),n.proxifiedObjectsMap.delete(r[o])));const a=Reflect.deleteProperty(r,o);return n.defaultCallback({op:"remove",path:s}),a}})(this,n,r)},i=Proxy.revocable(r,s);return i.trapsInstance=s,i.originalObject=r,this.parenthoodMap.set(r,{parent:n,path:o}),this.proxifiedObjectsMap.set(i.proxy,i),i.proxy},n.prototype._proxifyObjectTreeRecursively=function(e,n,r){for(let e in n)n.hasOwnProperty(e)&&n[e]instanceof Object&&(n[e]=this._proxifyObjectTreeRecursively(n,n[e],t(e)));return this.generateProxyAtPath(e,n,r)},n.prototype.proxifyObjectTree=function(t){this.pause(),this.isProxifyingTreeNow=!0;const e=this._proxifyObjectTreeRecursively(void 0,t,"");return this.isProxifyingTreeNow=!1,this.resume(),e},n.prototype.disableTrapsForProxy=function(t){if(this.showDetachedWarning){const e="You're accessing an object that is detached from the observedObject tree, see https://github.com/Palindrom/JSONPatcherProxy#detached-objects";t.trapsInstance.set=(t,n,r)=>(console.warn(e),Reflect.set(t,n,r)),t.trapsInstance.set=(t,n,r)=>(console.warn(e),Reflect.set(t,n,r)),t.trapsInstance.deleteProperty=(t,e)=>Reflect.deleteProperty(t,e)}else delete t.trapsInstance.set,delete t.trapsInstance.get,delete t.trapsInstance.deleteProperty},n.prototype.observe=function(t,e){if(!t&&!e)throw new Error("You need to either record changes or pass a callback");return this.isRecording=t,this.userCallback=e,t&&(this.patches=[]),this.cachedProxy=this.proxifyObjectTree(this.originalObject),this.cachedProxy},n.prototype.generate=function(){if(!this.isRecording)throw new Error("You should set record to true to get patches later");return this.patches.splice(0,this.patches.length)},n.prototype.revoke=function(){this.proxifiedObjectsMap.forEach(t=>{t.revoke()})},n.prototype.disableTraps=function(){this.proxifiedObjectsMap.forEach(this.disableTrapsForProxy,this)},n}();t.exports=r,t.exports.default=r},function(t,e,n){
/*!
 * https://github.com/Palindrom/JSONPatchOT
 * JSON-Patch-OT version: 1.0.1
 * (c) 2017 Tomek Wytrebowicz
 * MIT license
 */
var r=function(){var t=t||{};t.transform=function(t,n){var r=[];r=r.concat.apply(r,n);var o=JSON.parse(JSON.stringify(t));return r.reduce(e,o)},t.transformAgainstSingleOp=function(t,e){};var e=function(t,e){if(void 0===e.value&&("add"===e.op||"replace"===e.op||"test"===e.op))throw new Error("'value' MUST be defined");if(void 0===e.from&&("copy"===e.op||"move"===e.op))throw new Error("'from' MUST be defined");if(n[e.op])if("function"==typeof n[e.op])n[e.op](e,t);else for(var r=t.length,o=0;o<r;){var s=t[o];o++,n[e.op][s.op]&&n[e.op][s.op](e,s)}return t},n={remove:function(t,e){for(var n,s=e.length,i=0;n=e[i];)("add"!==n.op&&"test"!==n.op||t.path!==n.path)&&(n.from&&(n.from===t.path||0===n.from.indexOf(t.path+"/"))||t.path===n.path||0===n.path.indexOf(t.path+"/"))&&(e.splice(i,1),s--,i--),i++;var a=t.path.lastIndexOf("/");if(a>-1){var h=t.path.substr(a+1),c=t.path.substr(0,a+1);if(o(h))for(s=e.length,i=0;i<s;)n=e[i],i++,0===n.path.indexOf(c)&&(n.path=r(n.path,c,h)),n.from&&0===n.from.indexOf(c)&&(n.from=r(n.from,c,h))}},replace:function(t,e){for(var n,r=0;n=e[r];)(n.from&&(n.from===t.path||0===n.from.indexOf(t.path+"/"))||0===n.path.indexOf(t.path+"/"))&&(e.splice(r,1),r--),r++}};function r(t,e,n){var r=t.substr(e.length),s=r.indexOf("/");s>-1||(s=r.length);var i=r.substr(0,s),a=r.substr(s);return o(i)&&i>n?e+(i-1)+a:t}function o(t){var e=~~Number(t);return String(e)===t&&e>=0}return t}();t.exports=r,t.exports.default=r,t.exports.__esModule=!0},function(t,e,n){if(void 0===r)var r=n(18).JSONPatchQueue;var o=function(t,e,n,o,s){r.call(this,t,n,o,s),this.transform=e,this.pending=[]};(o.prototype=Object.create(r.prototype)).constructor=o,o.prototype.ackLocalVersion=0,o.prototype.send=function(t){var e=t.slice(0);e.unshift({op:"test",path:this.remotePath,value:this.remoteVersion});var n=r.prototype.send.call(this,e);return this.pending.push(n),n},o.prototype.receive=function(t,e){var n=e||this.apply,o=this;return r.prototype.receive.call(this,t,function(t,e){var r=e.slice(0),s=r.shift().value,i=s-o.ackLocalVersion;return o.ackLocalVersion=s,o.pending.splice(0,i),o.pending.length&&(r=o.transform(r,o.pending)),o.obj=n(o.obj,r)})},o.prototype.reset=function(t){return this.ackLocalVersion=r.getPropertyByJsonPointer(t,this.localPath),this.pending=[],this.obj=r.prototype.reset.call(this,t)},t.exports=o,t.exports.default=o,t.exports.__esModule=!0},function(t,e,n){(function(t,r){var o;/*! https://mths.be/punycode v1.3.2 by @mathias */!function(s){e&&e.nodeType,t&&t.nodeType;var i="object"==typeof r&&r;i.global!==i&&i.window!==i&&i.self;var a,h=2147483647,c=36,l=1,u=26,p=38,d=700,f=72,m=128,v="-",b=/^xn--/,y=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=c-l,j=Math.floor,P=String.fromCharCode;function O(t){throw RangeError(w[t])}function _(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function x(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+_((t=t.replace(g,".")).split("."),e).join(".")}function E(t){for(var e,n,r=[],o=0,s=t.length;o<s;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<s?56320==(64512&(n=t.charCodeAt(o++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--):r.push(e);return r}function C(t){return _(t,function(t){var e="";return t>65535&&(e+=P((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=P(t)}).join("")}function T(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,n){var r=0;for(t=n?j(t/d):t>>1,t+=j(t/e);t>S*u>>1;r+=c)t=j(t/S);return j(r+(S+1)*t/(t+p))}function k(t){var e,n,r,o,s,i,a,p,d,b,y,g=[],w=t.length,S=0,P=m,_=f;for((n=t.lastIndexOf(v))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&O("not-basic"),g.push(t.charCodeAt(r));for(o=n>0?n+1:0;o<w;){for(s=S,i=1,a=c;o>=w&&O("invalid-input"),((p=(y=t.charCodeAt(o++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:c)>=c||p>j((h-S)/i))&&O("overflow"),S+=p*i,!(p<(d=a<=_?l:a>=_+u?u:a-_));a+=c)i>j(h/(b=c-d))&&O("overflow"),i*=b;_=R(S-s,e=g.length+1,0==s),j(S/e)>h-P&&O("overflow"),P+=j(S/e),S%=e,g.splice(S++,0,P)}return C(g)}function U(t){var e,n,r,o,s,i,a,p,d,b,y,g,w,S,_,x=[];for(g=(t=E(t)).length,e=m,n=0,s=f,i=0;i<g;++i)(y=t[i])<128&&x.push(P(y));for(r=o=x.length,o&&x.push(v);r<g;){for(a=h,i=0;i<g;++i)(y=t[i])>=e&&y<a&&(a=y);for(a-e>j((h-n)/(w=r+1))&&O("overflow"),n+=(a-e)*w,e=a,i=0;i<g;++i)if((y=t[i])<e&&++n>h&&O("overflow"),y==e){for(p=n,d=c;!(p<(b=d<=s?l:d>=s+u?u:d-s));d+=c)_=p-b,S=c-b,x.push(P(T(b+_%S,0))),p=j(_/S);x.push(P(T(p,0))),s=R(n,w,r==o),n=0,++r}++n,++e}return x.join("")}a={version:"1.3.2",ucs2:{decode:E,encode:C},decode:k,encode:U,toASCII:function(t){return x(t,function(t){return y.test(t)?"xn--"+U(t):t})},toUnicode:function(t){return x(t,function(t){return b.test(t)?k(t.slice(4).toLowerCase()):t})}},void 0===(o=function(){return a}.call(e,n,e,t))||(t.exports=o)}()}).call(this,n(13)(t),n(5))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,n){"use strict";e.decode=e.parse=n(16),e.encode=e.stringify=n(17)},function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,s){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var a=/\+/g;t=t.split(e);var h=1e3;s&&"number"==typeof s.maxKeys&&(h=s.maxKeys);var c=t.length;h>0&&c>h&&(c=h);for(var l=0;l<c;++l){var u,p,d,f,m=t[l].replace(a,"%20"),v=m.indexOf(n);v>=0?(u=m.substr(0,v),p=m.substr(v+1)):(u=m,p=""),d=decodeURIComponent(u),f=decodeURIComponent(p),r(i,d)?o(i[d])?i[d].push(f):i[d]=[i[d],f]:i[d]=f}return i};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,a){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?s(i(t),function(i){var a=encodeURIComponent(r(i))+n;return o(t[i])?s(t[i],function(t){return a+encodeURIComponent(r(t))}).join(e):a+encodeURIComponent(r(t[i]))}).join(e):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function s(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var i=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e,n){var r=n(19),o=n(20);t.exports={JSONPatchQueue:r,JSONPatchQueueSynchronous:o,__esModule:!0}},function(t,e,n){var r=function(t,e,n,r){this.obj=t,this.waiting=[],this.localPath=e[0],this.remotePath=e[1],this.apply=n,this.purist=r};r.prototype.localVersion=0,r.prototype.remoteVersion=0,r.prototype.receive=function(t,e){var n=e||this.apply,r=t.slice(0);if(this.purist)r.shift();var o=r.shift().value;if(o<=this.remoteVersion)throw new Error("Given version was already applied.");if(o==this.remoteVersion+1)for(;r;)this.remoteVersion++,this.obj=n(this.obj,r),r=this.waiting.shift();else this.waiting[o-this.remoteVersion-2]=r},r.prototype.send=function(t){this.localVersion++;var e=t.slice(0);return this.purist?e.unshift({op:"test",path:this.localPath,value:this.localVersion-1},{op:"replace",path:this.localPath,value:this.localVersion}):e.unshift({op:"replace",path:this.localPath,value:this.localVersion}),e},r.getPropertyByJsonPointer=function(t,e){var n=e.split("/");""===n[0]&&n.shift();for(var r=t;n.length;){var o=n.shift().replace("~1","/").replace("~0","~");n.length&&(r=r[o])}return r[o]},r.prototype.reset=function(t){this.remoteVersion=r.getPropertyByJsonPointer(t,this.remotePath),this.waiting=[];var e=[{op:"replace",path:"",value:t}];return this.obj=this.apply(this.obj,e)},t.exports=r,t.exports.default=r,t.exports.__esModule=!0},function(t,e,n){var r=function(t,e,n,r){this.obj=t,this.waiting=[],this.versionPath=e,this.apply=n,this.purist=r};r.prototype.version=0,r.prototype.receive=function(t,e){var n=e||this.apply,r=t.slice(0);if(this.purist)r.shift();var o=r.shift().value;if(o<=this.version)throw new Error("Given version was already applied.");if(o==this.version+1)for(;r;)this.version++,this.obj=n(this.obj,r),r=this.waiting.shift();else this.waiting[o-this.version-2]=r},r.prototype.send=function(t){this.version++;var e=t.slice(0);return e.unshift({op:"replace",path:this.versionPath,value:this.version}),this.purist&&e.unshift({op:"test",path:this.versionPath,value:this.version-1}),e},r.getPropertyByJsonPointer=function(t,e){var n=e.split("/");""===n[0]&&n.shift();for(var r=t;n.length;){var o=n.shift().replace("~1","/").replace("~0","~");n.length&&(r=r[o])}return r[o]},r.prototype.reset=function(t){this.version=r.getPropertyByJsonPointer(t,this.versionPath),this.waiting=[];var e=[{op:"replace",path:"",value:t}];return this.obj=this.apply(this.obj,e)},t.exports=r,t.exports.default=r,t.exports.__esModule=!0},function(t,e,n){"use strict";n.r(e);var r=n(7),o=n(8),s=n(1),i=n(9),a=n.n(i),h=n(10),c=n.n(h),l=n(11),u=n.n(l),p=n(0);function d(t,e,n){let r,o,s,i;const a=1e3;function h(){r=a,o=0,s=!1,clearTimeout(i),i=null}const c=()=>{0==o?(e(0),s=!1,r*=2,t()):(e(o),o-=1e3,setTimeout(c,1e3))};this.triggerReconnection=()=>{s||(o=r,s=!0,c())},this.reconnectNow=()=>{o=0,r=a},this.stopReconnecting=()=>{h(),n()},h()}class f{constructor(t,e){this.obj=t,this.apply=e}send(t){return t}receive(t){return this.obj=this.apply(this.obj,t)}reset(t){const e=[{op:"replace",path:"",value:t}];return this.obj=this.apply(this.obj,e)}}
/*! Palindrom
 * https://github.com/Palindrom/Palindrom
 * (c) 2017 Joachim Wester
 * MIT license
 */const{applyPatch:m,validate:v}=Object(s.require)("fast-json-patch"),{JSONPatchQueueSynchronous:b,JSONPatchQueue:y}=Object(s.require)("json-patch-queue"),g="6.2.0";if(void 0===w)if("undefined"!=typeof window)var w=window;else w={};class S{static get version(){return g}constructor(t){if(this.version=g,"object"!=typeof t)throw new TypeError("Palindrom constructor requires an object argument.");if(!t.runAsServer&&!t.remoteUrl)throw new TypeError("remoteUrl is required");function e(){}t.callback&&console.warn("options.callback is deprecated. Please use `onStateReset` instead"),this.debug=null==t.debug||t.debug,this.isObserving=!1,this.onLocalChange=t.onLocalChange||e,this.onRemoteChange=t.onRemoteChange||e,this.onStateReset=t.onStateReset||t.callback||e,this.filterLocalChange=t.filterLocalChange||(t=>t),this.onPatchReceived=t.onPatchReceived||e,this.onPatchSent=t.onPatchSent||e,this.onSocketStateChanged=t.onSocketStateChanged||e,this.onConnectionError=t.onConnectionError||e,this.retransmissionThreshold=t.retransmissionThreshold||3,this.onReconnectionCountdown=t.onReconnectionCountdown||e,this.onReconnectionEnd=t.onReconnectionEnd||e,this.onSocketOpened=t.onSocketOpened||e,this.onIncomingPatchValidationError=t.onIncomingPatchValidationError||e,this.onOutgoingPatchValidationError=t.onOutgoingPatchValidationError||e,this.onError=t.onError||e,this.reconnector=new d(()=>this._connectToRemote(this.queue.pending),this.onReconnectionCountdown,this.onReconnectionEnd),this.network=new(t.runAsServer?o.a:r.a)(this,t.remoteUrl,t.useWebSocket||!1,this.handleRemoteChange.bind(this),this.onPatchSent.bind(this),this.onConnectionError.bind(this),this.onSocketOpened.bind(this),this.onSocketStateChanged.bind(this),t.runAsServer?t.wsServer:t.pingIntervalS,t.httpServer),this.OTPatchIndexOffset=0,t.localVersionPath?t.remoteVersionPath?(this.OTPatchIndexOffset=2,t.ot?this.queue=new u.a(this.obj,c.a.transform,[t.localVersionPath,t.remoteVersionPath],this.validateAndApplySequence.bind(this),t.purity):this.queue=new y(this.obj,[t.localVersionPath,t.remoteVersionPath],this.validateAndApplySequence.bind(this),t.purity)):(this.OTPatchIndexOffset=1,this.queue=new b(this.obj,t.localVersionPath,this.validateAndApplySequence.bind(this),t.purity)):this.queue=new f(this.obj,this.validateAndApplySequence.bind(this)),this.obj=t.obj,this._connectToRemote()}async _connectToRemote(t=null){const e=await this.network._establish(t,this.obj);this.reconnector.stopReconnecting(),this.debug&&(this.remoteObj=JSON.parse(JSON.stringify(e))),this.queue.reset(e)}get useWebSocket(){return this.network.useWebSocket}set useWebSocket(t){this.network.useWebSocket=t}_sendPatch(t){this.unobserve(),this.network.send(t),this.observe()}prepareProxifiedObject(t){t||(t={}),this.jsonPatcherProxy=new a.a(t);const e=this.jsonPatcherProxy.observe(!1,t=>{const e=this.filterLocalChange(t);e&&this.handleLocalChange(e)});Object.defineProperty(this,"obj",{get:()=>e,set(){throw new Error("palindrom.obj is readonly")},configurable:!0}),this.isObserving=!0}observe(){this.jsonPatcherProxy&&this.jsonPatcherProxy.resume(),this.isObserving=!0}unobserve(){this.jsonPatcherProxy&&this.jsonPatcherProxy.pause(),this.isObserving=!1}handleLocalChange(t){t.value&&j(t.value,this.onOutgoingPatchValidationError,t.path);const e=[t];this.debug&&this.validateSequence(this.remoteObj,e),this._sendPatch(this.queue.send(e)),this.onLocalChange(e)}validateAndApplySequence(t,e){try{this.unobserve();const n=m(t,e,this.debug);if(this.observe(),n.newDocument!==t){this.prepareProxifiedObject(n.newDocument),this.queue.obj=this.obj,j(this.obj,this.onIncomingPatchValidationError);try{this.onStateReset(this.obj)}catch(t){this.onError(new p.b(`Error inside onStateReset callback: ${t.message}`)),console.error(t)}}this.onRemoteChange(e,n)}catch(t){if(this.debug)return void this.onIncomingPatchValidationError(t);throw t}return this.obj}validateSequence(t,e){const n=v(e,t);n&&this.onOutgoingPatchValidationError(n)}reconnectNow(){this.reconnector.reconnectNow()}handleRemoteChange(t,e,n){this.onPatchReceived(t,e,n);const r=t||[];!function(t,e,n){for(let r=n,o=t.length;r<o;r++)j(t[r].value,e,t[r].path)}(r,this.onIncomingPatchValidationError,this.OTPatchIndexOffset),0!==r.length&&this.isObserving&&(this.queue.receive(r),this.queue.pending&&this.queue.pending.length&&this.queue.pending.length>this.retransmissionThreshold&&this.queue.pending.forEach(this._sendPatch,this),this.debug&&(this.remoteObj=JSON.parse(JSON.stringify(this.obj))))}}function j(t,e,n=""){const r=typeof t;if("object"==r)for(const r in t)t.hasOwnProperty(r)&&j(t[r],e,n+"/"+r);else"number"===r&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&e(new RangeError(`A number that is either bigger than Number.MAX_INTEGER_VALUE or smaller than Number.MIN_INTEGER_VALUE has been encountered in a patch, value is: ${t}, variable path is: ${n}`))}n.d(e,"PalindromDOM",function(){return _}),n.d(e,"Palindrom",function(){return S});
/*! Palindrom
 * https://github.com/Palindrom/Palindrom
 * (c) 2017 Joachim Wester
 * MIT license
 */
class P extends Error{}async function O(t){return new Promise(e=>{setTimeout(e,t)})}class _ extends S{constructor(t){if("object"!=typeof t)throw new Error("PalindromDOM constructor requires an object argument.");if(!t.remoteUrl)throw new Error("remoteUrl is required");const e=t.onStateReset||t.callback;t.callback&&console.warn("Palindrom: options.callback is deprecated. Please use `onStateReset` instead"),t.onStateReset=function(t){this.listen(),e&&e.call(this,t)},super(t),this.element=t.listenTo||document,this.clickHandler=this.clickHandler.bind(this),this.historyHandler=this.historyHandler.bind(this),this.morphUrlEventHandler=this.morphUrlEventHandler.bind(this),this._scrollWatcher=this._scrollWatcher.bind(this),this.element.addEventListener("palindrom-redirect-pushstate",this.morphUrlEventHandler),"scrollRestoration"in history&&(history.scrollRestoration="manual")}listen(){this.listening=!0,this.element.addEventListener("click",this.clickHandler),window.addEventListener("popstate",this.historyHandler),this.element.addEventListener("palindrom-morph-url",this.morphUrlEventHandler),this.element.addEventListener("palindrom-redirect-pushstate",this.morphUrlEventHandler),this._watchingScroll()}_watchingScroll(){window.addEventListener("scroll",this._scrollWatcher)}_unwatchingScroll(){window.removeEventListener("scroll",this._scrollWatcher)}_scrollWatcher(){this._attemptingScroll||(clearTimeout(this._scrollDebounceTimeout),this._scrollDebounceTimeout=setTimeout(()=>{history.replaceState([window.scrollX,window.scrollY],null)},20))}unlisten(){this.listening=!1,this.element.removeEventListener("click",this.clickHandler),window.removeEventListener("popstate",this.historyHandler),this.element.removeEventListener("palindrom-redirect-pushstate",this.morphUrlEventHandler),this.element.removeEventListener("palindrom-morph-url",this.morphUrlEventHandler),this._unwatchingScroll()}async getPatchUsingHTTP(t){const e=new CustomEvent("palindrom-before-redirect",{detail:{href:t},cancelable:!0,bubbles:!0});if(this.element.dispatchEvent(e),e.defaultPrevented)throw new P("`getPatchUsingHTTP` was aborted by cancelling `palindrom-before-redirect` event.");const n=await this.network.getPatchUsingHTTP(t);const r=new CustomEvent("palindrom-after-redirect",{detail:{href:t,data:n},bubbles:!0});return this.element.dispatchEvent(r),n}async morphUrl(t){const e=window.scrollX,n=window.scrollY;try{if(await this.getPatchUsingHTTP(t))return history.replaceState([e,n],null,window.location.href),history.pushState([0,0],null,t),scrollTo(0,0),!0}catch(t){if(t instanceof P)return!1;throw new Error(`HTTP request failed, error message: ${t.message}`)}}morphUrlEventHandler(t){return this.morphUrl(t.detail.url)}clickHandler(t){if(t.ctrlKey||t.metaKey||2==t.which)return;t.detail&&t.detail.target&&(t=t.detail);let e=t.target;if("A"!==e.nodeName){let n=t.composedPath&&t.composedPath();n||(n=t.path);for(let t=0;t<n.length;t++)if("A"==n[t].nodeName){e=n[t];break}}const n=e.target||e.getAttribute("target");if(!(e.hasAttribute("download")||n&&"_self"!==n)){const n=e.href||e.getAttribute("href");n&&_.isApplicationLink(n)?(t.preventDefault(),t.stopPropagation(),this.morphUrl(n)):"submit"===e.type&&t.preventDefault()}}async historyHandler(t){await this.getPatchUsingHTTP(location.href);const[e,n]=t.state||[0,0];let r=!1;this._attemptingScroll=!1;const o=()=>r=!this._attemptingScroll;window.addEventListener("scroll",o),await O(30);for(let t=0;t<30&&!r;t++){this._attemptingScroll=!0;const t=(s=e,i=n,scrollTo(s,i),window.scrollX===s&&window.scrollY===i);if(this._attemptingScroll=!1,t)break;await O(30)}var s,i;window.removeEventListener("scroll",o)}static isApplicationLink(t){if("string"==typeof t){const e=document.createElement("A");e.href=t,""==e.host&&(e.href=e.href),t=e}return t.protocol==window.location.protocol&&t.host==window.location.host}}}]).default;