var Palindrom=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){var o=n(7),r=n(6);e.exports={JSONPatchQueue:o,JSONPatchQueueSynchronous:r,__esModule:!0}},function(e,t,n){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 1.1.8
 * (c) 2013 Joachim Wester
 * MIT license
 */
var o;!function(e){function t(e,n){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===n;case"object":if(null===e)return null===n;if(h(e)){if(!h(n)||e.length!==n.length)return!1;for(var o=0,r=e.length;o<r;o++)if(!t(e[o],n[o]))return!1;return!0}var i=c(n),s=i.length;if(c(e).length!==s)return!1;for(var o=0;o<s;o++)if(!t(e[o],n[o]))return!1;return!0;default:return!1}}function n(e){for(var t,n=0,o=e.length;n<o;){t=e.charCodeAt(n);{if(!(t>=48&&t<=57))return!1;n++}}return!0}function o(e,t,o){for(var r,i,s=new Array(t.length),a=0,c=t.length;a<c;){r=t[a],a++;for(var d=r.path||"",v=d.split("/"),y=e,g=1,b=v.length,w=void 0;;){if(i=v[g],o&&void 0===w&&(void 0===y[i]?w=v.slice(0,g).join("/"):g==b-1&&(w=r.path),void 0!==w&&this.validator(r,a-1,e,w)),g++,void 0===i&&g>=b){s[a-1]=u[r.op].call(r,y,i,e);break}if(h(y)){if("-"===i)i=y.length;else{if(o&&!n(i))throw new f("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a-1,r.path,r);i=parseInt(i,10)}if(g>=b){if(o&&"add"===r.op&&i>y.length)throw new f("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a-1,r.path,r);s[a-1]=l[r.op].call(r,y,i,e);break}}else if(i&&i.indexOf("~")!=-1&&(i=i.replace(/~1/g,"/").replace(/~0/g,"~")),g>=b){s[a-1]=p[r.op].call(r,y,i,e);break}y=y[i]}}return s}function r(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(i(e[t]))return!0;return!1}function s(t,n,o,r){if("object"!=typeof t||null===t||h(t))throw new f("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,t,o);if(!p[t.op])throw new f("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,o);if("string"!=typeof t.path)throw new f("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,t,o);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new f('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,t,o);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new f("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new f("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&i(t.value))throw new f("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,t,o);if(o)if("add"==t.op){var s=t.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new f("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,t,o)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new f("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,t,o)}else if("move"===t.op||"copy"===t.op){var c={op:"_get",path:t.from,value:void 0},l=e.validate([c],o);if(l&&"OPERATION_PATH_UNRESOLVABLE"===l.name)throw new f("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,t,o)}}function a(e,t){try{if(!h(e))throw new f("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),o.call(this,t,e,!0);else for(var n=0;n<e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof f)return e;throw e}}var h,c=function(e){if(h(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o);return t},p={add:function(e,t){e[t]=this.value},remove:function(e,t){var n=e[t];return delete e[t],n},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:function(e,t,n){var r={op:"_get",path:this.path};o(n,[r]);var i=void 0===r.value?void 0:JSON.parse(JSON.stringify(r.value)),s={op:"_get",path:this.from};return o(n,[s]),o(n,[{op:"remove",path:this.from}]),o(n,[{op:"add",path:this.path,value:s.value}]),i},copy:function(e,t,n){var r={op:"_get",path:this.from};o(n,[r]),o(n,[{op:"add",path:this.path,value:r.value}])},test:function(e,n){return t(e[n],this.value)},_get:function(e,t){this.value=e[t]}},l={add:function(e,t){return e.splice(t,0,this.value),t},remove:function(e,t){return e.splice(t,1)[0]},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:p.move,copy:p.copy,test:p.test,_get:p._get},u={add:function(e){u.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t])},remove:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n],p.remove.call(this,e,n));return t},replace:function(e){var t=o(e,[{op:"remove",path:this.path}]);return o(e,[{op:"add",path:this.path,value:this.value}]),t[0]},move:p.move,copy:p.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}};h=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},e.apply=o;var f=function(e){function t(t,n,o,r,i){e.call(this,t),this.message=t,this.name=n,this.index=o,this.operation=r,this.tree=i}return r(t,e),t}(Error);e.JsonPatchError=f,e.validator=s,e.validate=a}(o||(o={}));var t,r;t.apply=o.apply,t.validate=o.validate,t.validator=o.validator,t.JsonPatchError=o.JsonPatchError,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,r&&(t=void 0)},function(e,t,n){if(void 0===o)var o=n(0).JSONPatchQueue;var r=function(e,t,n,r){o.call(this,t,n,r),this.transform=e,this.pending=[]};r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.ackLocalVersion=0,r.prototype.send=function(e){var t=e.slice(0);t.unshift({op:"test",path:this.remotePath,value:this.remoteVersion});var n=o.prototype.send.call(this,t);return this.pending.push(n),n},r.prototype.receive=function(e,t,n){var r=n||this.apply,i=this;return o.prototype.receive.call(this,e,t,function(e,t){var n=t.slice(0),o=n.shift().value,s=o-i.ackLocalVersion;i.ackLocalVersion=o,i.pending.splice(0,s),i.pending.length&&(n=i.transform(n,i.pending)),r(e,n)})},r.prototype.reset=function(e,t){this.ackLocalVersion=o.getPropertyByJsonPointer(t,this.localPath),this.pending=[],o.prototype.reset.call(this,e,t)},e.exports=r,e.exports.default=r,e.exports.__esModule=!0},function(e,t,n){/*!
 * https://github.com/Palindrom/JSONPatchOT
 * JSON-Patch-OT version: 1.0.1
 * (c) 2017 Tomek Wytrebowicz
 * MIT license
 */
var o=function(){function e(e,n,o){var r=e.substr(n.length),i=r.indexOf("/");i>-1||(i=r.length);var s=r.substr(0,i),a=r.substr(i);return t(s)&&s>o?n+(s-1)+a:e}function t(e){var t=~~Number(e);return String(t)===e&&t>=0}var n=!1,o=o||{};o.transform=function(e,t){var n=[];n=n.concat.apply(n,t);var o=JSON.parse(JSON.stringify(e));return n.reduce(r,o)},o.transformAgainstSingleOp=function(e,t){};var r=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(i[t.op])if("function"==typeof i[t.op])i[t.op](t,e);else for(var o=e.length,r=0;r<o;){var s=e[r];r++,i[t.op][s.op]?i[t.op][s.op](t,s):n&&console.log("No function to transform "+s.op+"against"+t.op)}else n&&console.log("No function to transform against "+t.op);return e},i={remove:function(o,r){n&&console.log("Transforming ",JSON.stringify(r)," against `remove` ",o);for(var i,s=r.length,a=0;i=r[a];)n&&console.log("TODO: `move`, and `copy` (`from`) may not be covered well (tomalec)"),("add"!==i.op&&"test"!==i.op||o.path!==i.path)&&(i.from&&(i.from===o.path||0===i.from.indexOf(o.path+"/"))||o.path===i.path||0===i.path.indexOf(o.path+"/"))&&(n&&console.log("Removing ",i),r.splice(a,1),s--,a--),a++;var h=o.path.lastIndexOf("/");if(h>-1){var c=o.path.substr(h+1),p=o.path.substr(0,h+1);if(t(c))for(n&&console.warn("Bug prone guessing that, as number given in path, this is an array!"),n&&console.log("Shifting array indexes"),s=r.length,a=0;a<s;)i=r[a],a++,0===i.path.indexOf(p)&&(i.path=e(i.path,p,c)),i.from&&0===i.from.indexOf(p)&&(i.from=e(i.from,p,c))}},replace:function(e,t){n&&console.log("Transforming ",JSON.stringify(t)," against `replace` ",e);for(var o,r=0;o=t[r];)n&&console.log("TODO: `move`, and `copy` (`from`) may not be covered well (tomalec)"),(o.from&&(o.from===e.path||0===o.from.indexOf(e.path+"/"))||0===o.path.indexOf(e.path+"/"))&&(n&&console.log("Removing ",o),t.splice(r,1),r--),r++}};return o}();e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t){e.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){/*!
 * https://github.com/PuppetJS/JSONPatcherProxy
 * JSONPatcherProxy version: 0.0.1
 * (c) 2017 Starcounter and contributors
 * MIT license
 */
var n=function(){function e(e){this.originalObject=e,this.cachedProxy=null,this.isRecording=!1,this.userCallback;var t=this;this.switchObserverOn=function(){t.defaultCallback=function(e){t.isRecording&&t.patches.push(e),t.userCallback&&t.userCallback(e)}},this.switchObserverOff=function(){t.defaultCallback=function(){}}}return e.deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},e.escapePathComponent=function(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")},e.prototype.generateProxyAtPath=function(t,n){if(!t)return t;var o=this;return new Proxy(t,{get:function(e,t,n){return"_isProxified"===t.toString()||Reflect.get(e,t,n)},set:function(t,r,i){var s=n+"/"+e.escapePathComponent(r.toString());if(i&&"object"==typeof i&&i._isProxified!==!0&&(i=o.generateProxyAtPath(i,s)),void 0===i){if(t.hasOwnProperty(r))return Array.isArray(t)?o.defaultCallback({op:"replace",path:s,value:null}):o.defaultCallback({op:"remove",path:s}),Reflect.set(t,r,i);if(!Array.isArray(t))return Reflect.set(t,r,i)}return Array.isArray(t)&&!Number.isInteger(+r.toString())?Reflect.set(t,r,i):t.hasOwnProperty(r)?void 0===t[r]?(Array.isArray(t)?o.defaultCallback({op:"replace",path:s,value:i}):o.defaultCallback({op:"add",path:s,value:i}),Reflect.set(t,r,i)):(o.defaultCallback({op:"replace",path:s,value:i}),Reflect.set(t,r,i)):(o.defaultCallback({op:"add",path:s,value:i}),Reflect.set(t,r,i))},deleteProperty:function(t,r){return void 0!==t[r]&&o.defaultCallback({op:"remove",path:n+"/"+e.escapePathComponent(r.toString())}),Reflect.deleteProperty(t,r)}})},e.prototype._proxifyObjectTreeRecursively=function(t,n){for(var o in t)if(t.hasOwnProperty(o)&&"object"==typeof t[o]){var r=n+"/"+e.escapePathComponent(o);t[o]=this.generateProxyAtPath(t[o],r),this._proxifyObjectTreeRecursively(t[o],r)}return this.generateProxyAtPath(t,"")},e.prototype.proxifyObjectTree=function(e){this.switchObserverOff();var t=this._proxifyObjectTreeRecursively(e,"");return this.switchObserverOn(),t},e.prototype.observe=function(t,n){if(!t&&!n)throw new Error("You need to either record changes or pass a callback");return this.isRecording=t,n&&(this.userCallback=n),t&&(this.patches=[]),this.cachedProxy=this.proxifyObjectTree(e.deepClone(this.originalObject))},e.prototype.generate=function(){if(!this.isRecording)throw new Error("You should set record to true to get patches later");return this.patches.splice(0,this.patches.length)},e.prototype.unobserve=function(){return e.deepClone(this.cachedProxy)},e}();e.exports=n,e.exports.default=n}])},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o=function(e,t,n){this.waiting=[],this.versionPath=e,this.apply=t,this.purist=n};o.prototype.version=0,o.prototype.receive=function(e,t,n){var o=n||this.apply,r=t.slice(0);if(this.purist){r.shift()}var i=r.shift(),s=i.value;if(s<=this.version)throw new Error("Given version was already applied.");if(s==this.version+1)for(;r;)this.version++,o(e,r),r=this.waiting.shift();else this.waiting[s-this.version-2]=r},o.prototype.send=function(e){this.version++;var t=e.slice(0);return t.unshift({op:"replace",path:this.versionPath,value:this.version}),this.purist&&t.unshift({op:"test",path:this.versionPath,value:this.version-1}),t},o.getPropertyByJsonPointer=function(e,t){var n=t.split("/");""===n[0]&&n.shift();for(var o=e;n.length;){var r=n.shift().replace("~1","/").replace("~0","~");n.length&&(o=o[r])}return o[r]},o.prototype.reset=function(e,t){this.version=o.getPropertyByJsonPointer(t,this.versionPath),this.waiting=[];var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t,n){var o=function(e,t,n){this.waiting=[],this.localPath=e[0],this.remotePath=e[1],this.apply=t,this.purist=n};o.prototype.localVersion=0,o.prototype.remoteVersion=0,o.prototype.receive=function(e,t,n){var o=n||this.apply,r=t.slice(0);if(this.purist){r.shift()}var i=r.shift(),s=i.value;if(s<=this.remoteVersion)throw new Error("Given version was already applied.");if(s==this.remoteVersion+1)for(;r;)this.remoteVersion++,o(e,r),r=this.waiting.shift();else this.waiting[s-this.remoteVersion-2]=r},o.prototype.send=function(e){this.localVersion++;var t=e.slice(0);return this.purist?t.unshift({op:"test",path:this.localPath,value:this.localVersion-1},{op:"replace",path:this.localPath,value:this.localVersion}):t.unshift({op:"replace",path:this.localPath,value:this.localVersion}),t},o.getPropertyByJsonPointer=function(e,t){var n=t.split("/");""===n[0]&&n.shift();for(var o=e;n.length;){var r=n.shift().replace("~1","/").replace("~0","~");n.length&&(o=o[r])}return o[r]},o.prototype.reset=function(e,t){this.remoteVersion=o.getPropertyByJsonPointer(t,this.remotePath),this.waiting=[];var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t,n){(function(t){var o=n(1),r=n(4),i=n(0).JSONPatchQueueSynchronous,s=n(0).JSONPatchQueue,a=n(3),h=n(2),c=function(){function e(e,t){var n=t.replace(/^http/i,"ws");e.wsUrl=n}function t(e,t,n){function o(){r=h,i=0,s=!1,clearTimeout(a),a=null}var r,i,s,a,h=1e3,c=function(){0==i?(t(0),s=!1,r*=2,e()):(t(i),i-=1e3,setTimeout(c,1e3))};this.triggerReconnection=function(){s||(i=r,s=!0,c())},this.reconnectNow=function(){i=0,r=h},this.stopReconnecting=function(){o(),n()},o()}function n(e,t,n,o){var r,i;this.start=function(){r||(r=setTimeout(function(){this.notifySend(),e()}.bind(this),n))},this.notifySend=function(){clearTimeout(r),r=null,i||(i=setTimeout(function(){i=null,t()}.bind(this),o))},this.notifyReceive=function(){clearTimeout(i),i=null,this.start()},this.stop=function(){clearTimeout(r),r=null,clearTimeout(i),i=null}}function c(){this.start=this.stop=this.notifySend=this.notifyReceive=function(){}}function p(t,n,o,r,i,s,a,h){this.palindrom=t,this.remoteUrl=new URL(n,window.location.href),o&&e(this,this.remoteUrl.href),r&&(this.onReceive=r),i&&(this.onSend=i),s&&(this.onConnectionError=s),a&&(this.onFatalError=a),h&&(this.onStateChange=h);var c=this;Object.defineProperty(this,"useWebSocket",{get:function(){return o},set:function(t){return o=t,0==t?c._ws&&(c._ws.onclose=function(){c._ws=null},c._ws.close()):c.wsUrl||e(this,t),o}})}function l(e,t,n,o){return e.xhr(t,"application/json",n,function(t){o(t.responseText),e.useWebSocket&&e.webSocketUpgrade()})}function u(e){e._ws&&(e._ws.onclose=function(){},e._ws.close(),e._ws=null)}function f(e){this.apply=e}function d(e,t){e.heartbeat.stop(),t(function(t){var n=JSON.parse(t);e.reconnector.stopReconnecting(),e.queue.reset(e.obj,n),e.debug&&(e.remoteObj=t),e.observe(),e.onDataReady&&e.onDataReady.call(e,e.obj),e.heartbeat.start()})}function v(e){d(e,e.network.establish.bind(e.network))}function y(e){d(e,function(t){e.network.reestablish(e.queue.pending,t)})}function g(e){if("object"!=typeof e)throw new Error("Palindrom constructor requires an object argument.");if(!e.remoteUrl)throw new Error("remoteUrl is required");if(this.jsonpatch=e.jsonpatch||this.jsonpatch,this.debug=void 0==e.debug||e.debug,"obj"in e){if("object"!=typeof e.obj)throw new Error("'options.obj' is not an object");this.obj=e.obj}else this.obj={};this.jsonPatcherProxy=new r(this.obj);var o=function(){};if(this.isObjectProxified=!1,this.isObserving=!1,this.onLocalChange=e.onLocalChange,this.onRemoteChange=e.onRemoteChange,this.onPatchReceived=e.onPatchReceived||o,this.onPatchSent=e.onPatchSent||o,this.onSocketStateChanged=e.onSocketStateChanged||o,this.onConnectionError=e.onConnectionError||o,this.retransmissionThreshold=e.retransmissionThreshold||3,this.onReconnectionCountdown=e.onReconnectionCountdown||o,this.onReconnectionEnd=e.onReconnectionEnd||o,this.reconnector=new t(function(){y(this)}.bind(this),this.onReconnectionCountdown,this.onReconnectionEnd),e.pingIntervalS){const l=1e3*e.pingIntervalS;this.heartbeat=new n(this.ping.bind(this),this.handleConnectionError.bind(this),l,l)}else this.heartbeat=new c;this.network=new p(this,e.remoteUrl,e.useWebSocket||!1,this.handleRemoteChange.bind(this),this.onPatchSent.bind(this),this.handleConnectionError.bind(this),this.handleFatalError.bind(this),this.onSocketStateChanged.bind(this)),Object.defineProperty(this,"useWebSocket",{get:function(){return this.network.useWebSocket},set:function(e){this.network.useWebSocket=e}}),this.ignoreCache={},this.ignoreAdd=e.ignoreAdd||null,this.onDataReady=e.callback,e.localVersionPath?e.remoteVersionPath?this.queue=e.ot?new h(a.transform,[e.localVersionPath,e.remoteVersionPath],this.validateAndApplySequence.bind(this),e.purity):new s([e.localVersionPath,e.remoteVersionPath],this.validateAndApplySequence.bind(this),e.purity):this.queue=new i(e.localVersionPath,this.validateAndApplySequence.bind(this),e.purity):this.queue=new f(this.validateAndApplySequence.bind(this)),v(this)}function b(e,t,n,o){if("add"===o&&e.test(n))return t[n]=!0,!0;for(var r=n.split("/"),i="",s=1,a=r.length;s<a;s++)if(i+="/"+r[s],t[i])return!0;return!1}function w(e,t){var n=JSON.stringify(t);e.unobserve(),e.heartbeat.notifySend(),e.network.send(n),e.observe()}if(void 0===m)if("undefined"!=typeof window)var m=window;else var m={};var O=function(){};O.prototype={constructor:O,apply:function(e){e.addEventListener=O.prototype.addEventListener,e.hasEventListener=O.prototype.hasEventListener,e.removeEventListener=O.prototype.removeEventListener,e.dispatchEvent=O.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,o=n[e];if(void 0!==o){var r=o.indexOf(t);r!==-1&&o.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var o=[],r=n.length,i=0;i<r;i++)o[i]=n[i];for(var i=0;i<r;i++)o[i].call(this,e)}}}},p.prototype.establish=function(e){l(this,this.remoteUrl.href,null,e)},p.prototype.reestablish=function(e,t){l(this,this.remoteUrl.href+"/reconnect",JSON.stringify(e),t)},p.prototype.send=function(e){var t=this;if(this.useWebSocket&&this._ws&&1===this._ws.readyState)this._ws.send(e),t.onSend(e,t._ws.url,"WS");else{var n=this.remoteUrl.href;this.xhr(n,"application/json-patch+json",e,function(e,o){t.onReceive(e.responseText,n,o)})}return this},p.prototype.onReceive=function(){},p.prototype.onSend=function(){},p.prototype.onStateChange=function(){},p.prototype.upgrade=function(e){},p.prototype.webSocketUpgrade=function(e){var t=this,n=new URL(this.remoteUrl.pathname,this.wsUrl).href;u(t),t._ws=new WebSocket(n),t._ws.onopen=function(o){t.onStateChange(t._ws.readyState,n),e&&e(o)},t._ws.onmessage=function(e){t.onReceive(e.data,t._ws.url,"WS")},t._ws.onerror=function(e){if(t.onStateChange(t._ws.readyState,n,e.data),t.useWebSocket){var o={statusText:"WebSocket connection could not be made.",readyState:t._ws.readyState,url:n};t.onFatalError(o,n,"WS")}},t._ws.onclose=function(e){t.onStateChange(t._ws.readyState,n,null,e.code,e.reason);var o={statusText:"WebSocket connection closed.",readyState:t._ws.readyState,url:n,statusCode:e.code,reason:e.reason};e.reason?t.onFatalError(o,n,"WS"):t.onConnectionError()}},p.prototype.changeState=function(e){var t=this;return this.xhr(e,"application/json-patch+json",null,function(n,o){t.onReceive(n.responseText,e,o)},!0)},p.prototype.setRemoteUrl=function(e){if(this.remoteUrlSet&&this.remoteUrl&&this.remoteUrl!=e)throw new Error("Session lost. Server replied with a different session ID that was already set. \nPossibly a server restart happened while you were working. \nPlease reload the page.\n\nPrevious session ID: "+this.remoteUrl+"\nNew session ID: "+e);this.remoteUrlSet=!0,this.remoteUrl=new URL(e,this.remoteUrl)},p.prototype.handleResponseHeader=function(e){var t=e.getResponseHeader("X-Location")||e.getResponseHeader("Location");t&&this.setRemoteUrl(t)},p.prototype.xhr=function(e,t,n,o,r){var i=this,s=new XMLHttpRequest,a="GET";return s.onload=function(){var t=this;i.handleResponseHeader(t),t.status>=400&&t.status<=599?i.onFatalError({statusCode:t.status,statusText:t.statusText,reason:t.responseText},e,a):o&&o.call(i.palindrom,t,a)},s.onerror=i.onConnectionError.bind(i),n?(a="PATCH",s.open(a,e,!0),s.setRequestHeader("Content-Type","application/json-patch+json")):s.open(a,e,!0),t&&s.setRequestHeader("Accept",t),i.remoteUrl&&r&&s.setRequestHeader("X-Referer",i.remoteUrl.pathname),i.onSend(n,e,a),s.send(n),s},f.prototype.send=function(e){return e},f.prototype.receive=function(e,t){this.apply(e,t)},f.prototype.reset=function(e,t){var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},g.prototype=Object.create(O.prototype);var P=function(e,t){var n;if(ErrorEvent.prototype.initErrorEvent){var o=document.createEvent("ErrorEvent");o.initErrorEvent("error",!0,!0,t.message,"",""),Object.defineProperty(o,"error",{value:t})}else n=new ErrorEvent("error",{bubbles:!0,cancelable:!0,error:t});e.dispatchEvent(n)};return g.prototype.jsonpatch=o,g.prototype.ping=function(){w(this,[])},g.prototype.observe=function(){this.isObjectProxified?this.jsonPatcherProxy.switchObserverOn():(this.obj=this.jsonPatcherProxy.observe(!0,this.filterChangedCallback.bind(this)),this.isObjectProxified=!0),this.isObserving=!0},g.prototype.unobserve=function(){this.jsonPatcherProxy&&this.jsonPatcherProxy.switchObserverOff(),this.isObserving=!1},g.prototype.filterChangedCallback=function(e){var t=[e];this.filterIgnoredPatches(t),t.length&&this.handleLocalChange(t)},g.prototype.filterIgnoredPatches=function(e){if(this.ignoreAdd)for(var t=0,n=e.length;t<n;t++)b(this.ignoreAdd,this.ignoreCache,e[t].path,e[t].op)&&(e.splice(t,1),n--,t--);return e},g.prototype.handleLocalChange=function(e){this.debug&&this.validateSequence(this.remoteObj,e),w(this,this.queue.send(e)),this.onLocalChange&&this.onLocalChange(e)},g.prototype.validateAndApplySequence=function(e,t){this.unobserve();try{var n=this.jsonpatch.apply(e,t,this.debug)}catch(e){if(this.debug)return e.message="Incoming patch validation error: "+e.message,void P(this,e);throw e}var o=this;t.forEach(function(e){if(""===e.path){var n=JSON.stringify(t);n.length>103&&(n=n.substring(0,100)+"..."),o.showWarning("Server pushed patch that replaces the object root",n)}}),this.observe(),this.onRemoteChange&&(console.warn("Palindrom.onRemoteChange is deprecated, please use patch-applied event instead."),this.onRemoteChange(t,n)),this.dispatchEvent(new CustomEvent("patch-applied",{bubbles:!0,cancelable:!0,detail:{patches:t,results:n}}))},g.prototype.validateSequence=function(e,t){var n=this.jsonpatch.validate(t,e);n&&(n.message="Outgoing patch validation error: "+n.message,P(this,n))},g.prototype.handleConnectionError=function(){this.heartbeat.stop(),this.reconnector.triggerReconnection()},g.prototype.handleFatalError=function(e,t,n){this.heartbeat.stop(),this.reconnector.stopReconnecting(),this.onConnectionError&&this.onConnectionError(e,t,n)},g.prototype.reconnectNow=function(){this.reconnector.reconnectNow()},g.prototype.showWarning=function(e,t){this.debug&&m.console&&console.warn&&(t&&(e+=" ("+t+")"),console.warn("Palindrom warning: "+e))},g.prototype.handleRemoteChange=function(e,t,n){this.heartbeat.notifyReceive();var o=JSON.parse(e||"[]");0!==o.length&&(this.onPatchReceived&&this.onPatchReceived(e,t,n),this.isObserving&&(this.queue.receive(this.obj,o),this.queue.pending&&this.queue.pending.length&&this.queue.pending.length>this.retransmissionThreshold&&this.queue.pending.forEach(w.bind(null,this)),this.debug&&(this.remoteObj=JSON.parse(JSON.stringify(this.obj)))))},m.Puppet=g,g}();e.exports=c,e.exports.default=c,e.exports.__esModule=!0}).call(t,n(5))}]);