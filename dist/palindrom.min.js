var Palindrom=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){var o=n(6),r=n(5);e.exports={JSONPatchQueue:o,JSONPatchQueueSynchronous:r,__esModule:!0}},function(e,t,n){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 1.1.8
 * (c) 2013 Joachim Wester
 * MIT license
 */
var o;!function(e){function t(e,n){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===n;case"object":if(null===e)return null===n;if(P(e)){if(!P(n)||e.length!==n.length)return!1;for(var o=0,r=e.length;o<r;o++)if(!t(e[o],n[o]))return!1;return!0}var i=m(n),s=i.length;if(m(e).length!==s)return!1;for(var o=0;o<s;o++)if(!t(e[o],n[o]))return!1;return!0;default:return!1}}function n(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function o(e){for(var t=0,n=O.length;t<n;t++)if(O[t].obj===e)return O[t]}function r(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].callback===t)return e.observers[n].observer}function i(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}function s(e,t){t.unobserve()}function a(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function h(e,t){var n,s=[],h=o(e);if(h?n=r(h,t):(h=new S(e),O.push(h)),n)return n;if(n={},h.value=a(e),t){n.callback=t,n.next=null;var p=function(){c(n)},u=function(){clearTimeout(n.next),n.next=setTimeout(p)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",u),window.addEventListener("keyup",u),window.addEventListener("mousedown",u),window.addEventListener("keydown",u),window.addEventListener("change",u)):(document.documentElement.attachEvent("onmouseup",u),document.documentElement.attachEvent("onkeyup",u),document.documentElement.attachEvent("onmousedown",u),document.documentElement.attachEvent("onkeydown",u),document.documentElement.attachEvent("onchange",u)))}return n.patches=s,n.object=e,n.unobserve=function(){c(n),clearTimeout(n.next),i(h,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",u),window.removeEventListener("keyup",u),window.removeEventListener("mousedown",u),window.removeEventListener("keydown",u)):(document.documentElement.detachEvent("onmouseup",u),document.documentElement.detachEvent("onkeyup",u),document.documentElement.detachEvent("onmousedown",u),document.documentElement.detachEvent("onkeydown",u)))},h.observers.push(new _(t,n)),n}function c(e){for(var t,n=0,o=O.length;n<o;n++)if(O[n].obj===e.object){t=O[n];break}p(t.value,e.object,e.patches,""),e.patches.length&&l(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function p(e,t,o,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=m(t),s=m(e),h=!1,c=s.length-1;c>=0;c--){var u=s[c],l=e[u];if(!t.hasOwnProperty(u)||void 0===t[u]&&void 0!==l&&P(t)===!1)o.push({op:"remove",path:r+"/"+n(u)}),h=!0;else{var f=t[u];"object"==typeof l&&null!=l&&"object"==typeof f&&null!=f?p(l,f,o,r+"/"+n(u)):l!==f&&(!0,o.push({op:"replace",path:r+"/"+n(u),value:a(f)}))}}if(h||i.length!=s.length)for(var c=0;c<i.length;c++){var u=i[c];e.hasOwnProperty(u)||void 0===t[u]||o.push({op:"add",path:r+"/"+n(u),value:a(t[u])})}}}function u(e){for(var t,n=0,o=e.length;n<o;){t=e.charCodeAt(n);{if(!(t>=48&&t<=57))return!1;n++}}return!0}function l(e,t,n){for(var o,r,i=[],s=0,a=t.length;s<a;){o=t[s],s++;for(var h=o.path||"",c=h.split("/"),p=e,l=1,f=c.length,d=void 0;;){if(r=c[l],n&&void 0===d&&(void 0===p[r]?d=c.slice(0,l).join("/"):l==f-1&&(d=o.path),void 0!==d&&this.validator(o,s-1,e,d)),l++,void 0===r&&l>=f){i.push(E[o.op].call(o,p,r,e));break}if(P(p)){if("-"===r)r=p.length;else{if(n&&!u(r))throw new R("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s-1,o.path,o);r=parseInt(r,10)}if(l>=f){if(n&&"add"===o.op&&r>p.length)throw new R("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s-1,o.path,o);i.push(b[o.op].call(o,p,r,e));break}}else if(r&&r.indexOf("~")!=-1&&(r=r.replace(/~1/g,"/").replace(/~0/g,"~")),l>=f){i.push(w[o.op].call(o,p,r,e));break}p=p[r]}}return i}function f(e,t){var n=[];return p(e,t,n,""),n}function d(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function v(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(v(e[t]))return!0;return!1}function g(t,n,o,r){if("object"!=typeof t||null===t||P(t))throw new R("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,t,o);if(!w[t.op])throw new R("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,o);if("string"!=typeof t.path)throw new R("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,t,o);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new R('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,t,o);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new R("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new R("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&v(t.value))throw new R("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,t,o);if(o)if("add"==t.op){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new R("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,t,o)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new R("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,t,o)}else if("move"===t.op||"copy"===t.op){var a={op:"_get",path:t.from,value:void 0},h=e.validate([a],o);if(h&&"OPERATION_PATH_UNRESOLVABLE"===h.name)throw new R("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,t,o)}}function y(e,t){try{if(!P(e))throw new R("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),l.call(this,t,e,!0);else for(var n=0;n<e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof R)return e;throw e}}var m=function(e){if(P(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o);return t},w={add:function(e,t){e[t]=this.value},remove:function(e,t){var n=e[t];return delete e[t],n},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:function(e,t,n){var o={op:"_get",path:this.path};l(n,[o]);var r=void 0===o.value?void 0:JSON.parse(JSON.stringify(o.value)),i={op:"_get",path:this.from};return l(n,[i]),l(n,[{op:"remove",path:this.from}]),l(n,[{op:"add",path:this.path,value:i.value}]),r},copy:function(e,t,n){var o={op:"_get",path:this.from};l(n,[o]),l(n,[{op:"add",path:this.path,value:o.value}])},test:function(e,n){return t(e[n],this.value)},_get:function(e,t){this.value=e[t]}},b={add:function(e,t){return e.splice(t,0,this.value),t},remove:function(e,t){return e.splice(t,1)[0]},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:w.move,copy:w.copy,test:w.test,_get:w._get},E={add:function(e){E.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t])},remove:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n],w.remove.call(this,e,n));return t},replace:function(e){var t=l(e,[{op:"remove",path:this.path}]);return l(e,[{op:"add",path:this.path,value:this.value}]),t[0]},move:w.move,copy:w.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}},O=[],S=function(){function e(e){this.observers=[],this.obj=e}return e}(),_=function(){function e(e,t){this.callback=e,this.observer=t}return e}();e.unobserve=s,e.observe=h,e.generate=c;var P;P=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},e.apply=l,e.compare=f;var R=function(e){function t(t,n,o,r,i){e.call(this,t),this.message=t,this.name=n,this.index=o,this.operation=r,this.tree=i}return d(t,e),t}(Error);e.JsonPatchError=R,e.validator=g,e.validate=y}(o||(o={}));var t,r;t.apply=o.apply,t.observe=o.observe,t.unobserve=o.unobserve,t.generate=o.generate,t.compare=o.compare,t.validate=o.validate,t.validator=o.validator,t.JsonPatchError=o.JsonPatchError,Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,r&&(t=void 0)},function(e,t,n){if(void 0===o)var o=n(0).JSONPatchQueue;var r=function(e,t,n,r){o.call(this,t,n,r),this.transform=e,this.pending=[]};r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.ackLocalVersion=0,r.prototype.send=function(e){var t=e.slice(0);t.unshift({op:"test",path:this.remotePath,value:this.remoteVersion});var n=o.prototype.send.call(this,t);return this.pending.push(n),n},r.prototype.receive=function(e,t,n){var r=n||this.apply,i=this;return o.prototype.receive.call(this,e,t,function(e,t){var n=t.slice(0),o=n.shift().value,s=o-i.ackLocalVersion;i.ackLocalVersion=o,i.pending.splice(0,s),i.pending.length&&(n=i.transform(n,i.pending)),r(e,n)})},r.prototype.reset=function(e,t){this.ackLocalVersion=o.getPropertyByJsonPointer(t,this.localPath),this.pending=[],o.prototype.reset.call(this,e,t)},e.exports=r,e.exports.default=r,e.exports.__esModule=!0},function(e,t,n){/*!
 * https://github.com/Palindrom/JSONPatchOT
 * JSON-Patch-OT version: 1.0.1
 * (c) 2017 Tomek Wytrebowicz
 * MIT license
 */
var o=function(){function e(e,n,o){var r=e.substr(n.length),i=r.indexOf("/");i>-1||(i=r.length);var s=r.substr(0,i),a=r.substr(i);return t(s)&&s>o?n+(s-1)+a:e}function t(e){var t=~~Number(e);return String(t)===e&&t>=0}var n=!1,o=o||{};o.transform=function(e,t){var n=[];n=n.concat.apply(n,t);var o=JSON.parse(JSON.stringify(e));return n.reduce(r,o)},o.transformAgainstSingleOp=function(e,t){};var r=function(e,t){if(void 0===t.value&&("add"===t.op||"replace"===t.op||"test"===t.op))throw new Error("'value' MUST be defined");if(void 0===t.from&&("copy"===t.op||"move"===t.op))throw new Error("'from' MUST be defined");if(i[t.op])if("function"==typeof i[t.op])i[t.op](t,e);else for(var o=e.length,r=0;r<o;){var s=e[r];r++,i[t.op][s.op]?i[t.op][s.op](t,s):n&&console.log("No function to transform "+s.op+"against"+t.op)}else n&&console.log("No function to transform against "+t.op);return e},i={remove:function(o,r){n&&console.log("Transforming ",JSON.stringify(r)," against `remove` ",o);for(var i,s=r.length,a=0;i=r[a];)n&&console.log("TODO: `move`, and `copy` (`from`) may not be covered well (tomalec)"),("add"!==i.op&&"test"!==i.op||o.path!==i.path)&&(i.from&&(i.from===o.path||0===i.from.indexOf(o.path+"/"))||o.path===i.path||0===i.path.indexOf(o.path+"/"))&&(n&&console.log("Removing ",i),r.splice(a,1),s--,a--),a++;var h=o.path.lastIndexOf("/");if(h>-1){var c=o.path.substr(h+1),p=o.path.substr(0,h+1);if(t(c))for(n&&console.warn("Bug prone guessing that, as number given in path, this is an array!"),n&&console.log("Shifting array indexes"),s=r.length,a=0;a<s;)i=r[a],a++,0===i.path.indexOf(p)&&(i.path=e(i.path,p,c)),i.from&&0===i.from.indexOf(p)&&(i.from=e(i.from,p,c))}},replace:function(e,t){n&&console.log("Transforming ",JSON.stringify(t)," against `replace` ",e);for(var o,r=0;o=t[r];)n&&console.log("TODO: `move`, and `copy` (`from`) may not be covered well (tomalec)"),(o.from&&(o.from===e.path||0===o.from.indexOf(e.path+"/"))||0===o.path.indexOf(e.path+"/"))&&(n&&console.log("Removing ",o),t.splice(r,1),r--),r++}};return o}();e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o=function(e,t,n){this.waiting=[],this.versionPath=e,this.apply=t,this.purist=n};o.prototype.version=0,o.prototype.receive=function(e,t,n){var o=n||this.apply,r=t.slice(0);if(this.purist){r.shift()}var i=r.shift(),s=i.value;if(s<=this.version)throw new Error("Given version was already applied.");if(s==this.version+1)for(;r;)this.version++,o(e,r),r=this.waiting.shift();else this.waiting[s-this.version-2]=r},o.prototype.send=function(e){this.version++;var t=e.slice(0);return t.unshift({op:"replace",path:this.versionPath,value:this.version}),this.purist&&t.unshift({op:"test",path:this.versionPath,value:this.version-1}),t},o.getPropertyByJsonPointer=function(e,t){var n=t.split("/");""===n[0]&&n.shift();for(var o=e;n.length;){var r=n.shift().replace("~1","/").replace("~0","~");n.length&&(o=o[r])}return o[r]},o.prototype.reset=function(e,t){this.version=o.getPropertyByJsonPointer(t,this.versionPath),this.waiting=[];var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t,n){var o=function(e,t,n){this.waiting=[],this.localPath=e[0],this.remotePath=e[1],this.apply=t,this.purist=n};o.prototype.localVersion=0,o.prototype.remoteVersion=0,o.prototype.receive=function(e,t,n){var o=n||this.apply,r=t.slice(0);if(this.purist){r.shift()}var i=r.shift(),s=i.value;if(s<=this.remoteVersion)throw new Error("Given version was already applied.");if(s==this.remoteVersion+1)for(;r;)this.remoteVersion++,o(e,r),r=this.waiting.shift();else this.waiting[s-this.remoteVersion-2]=r},o.prototype.send=function(e){this.localVersion++;var t=e.slice(0);return this.purist?t.unshift({op:"test",path:this.localPath,value:this.localVersion-1},{op:"replace",path:this.localPath,value:this.localVersion}):t.unshift({op:"replace",path:this.localPath,value:this.localVersion}),t},o.getPropertyByJsonPointer=function(e,t){var n=t.split("/");""===n[0]&&n.shift();for(var o=e;n.length;){var r=n.shift().replace("~1","/").replace("~0","~");n.length&&(o=o[r])}return o[r]},o.prototype.reset=function(e,t){this.remoteVersion=o.getPropertyByJsonPointer(t,this.remotePath),this.waiting=[];var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},e.exports=o,e.exports.default=o,e.exports.__esModule=!0},function(e,t,n){(function(t){var o=n(1),r=n(0).JSONPatchQueueSynchronous,i=n(0).JSONPatchQueue,s=n(3),a=n(2),h=function(){function e(e,t){var n=t.replace(/^http/i,"ws");e.wsUrl=n}function t(e,t,n){function o(){r=h,i=0,s=!1,clearTimeout(a),a=null}var r,i,s,a,h=1e3,c=function(){0==i?(t(0),s=!1,r*=2,e()):(t(i),i-=1e3,setTimeout(c,1e3))};this.triggerReconnection=function(){s||(i=r,s=!0,c())},this.reconnectNow=function(){i=0,r=h},this.stopReconnecting=function(){o(),n()},o()}function n(e,t,n,o){var r,i;this.start=function(){r||(r=setTimeout(function(){this.notifySend(),e()}.bind(this),n))},this.notifySend=function(){clearTimeout(r),r=null,i||(i=setTimeout(function(){i=null,t()}.bind(this),o))},this.notifyReceive=function(){clearTimeout(i),i=null,this.start()},this.stop=function(){clearTimeout(r),r=null,clearTimeout(i),i=null}}function h(){this.start=this.stop=this.notifySend=this.notifyReceive=function(){}}function c(t,n,o,r,i,s,a,h){this.palindrom=t,this.remoteUrl=new URL(n,window.location.href),o&&e(this,this.remoteUrl.href),r&&(this.onReceive=r),i&&(this.onSend=i),s&&(this.onConnectionError=s),a&&(this.onFatalError=a),h&&(this.onStateChange=h);var c=this;Object.defineProperty(this,"useWebSocket",{get:function(){return o},set:function(t){return o=t,0==t?c._ws&&(c._ws.onclose=function(){c._ws=null},c._ws.close()):c.wsUrl||e(this,t),o}})}function p(e,t,n,o){return e.xhr(t,"application/json",n,function(t){o(t.responseText),e.useWebSocket&&e.webSocketUpgrade()})}function u(e){e._ws&&(e._ws.onclose=function(){},e._ws.close(),e._ws=null)}function l(e){this.apply=e}function f(e,t){e.heartbeat.stop(),t(function(t){var n=JSON.parse(t);e.reconnector.stopReconnecting(),e.queue.reset(e.obj,n),e.debug&&(e.remoteObj=t),e.observe(),e.onDataReady&&e.onDataReady.call(e,e.obj),e.heartbeat.start()})}function d(e){f(e,e.network.establish.bind(e.network))}function v(e){f(e,function(t){e.network.reestablish(e.queue.pending,t)})}function g(e){if("object"!=typeof e)throw new Error("Palindrom constructor requires an object argument.");if(!e.remoteUrl)throw new Error("remoteUrl is required");if(this.jsonpatch=e.jsonpatch||this.jsonpatch,this.debug=void 0==e.debug||e.debug,"obj"in e){if("object"!=typeof e.obj)throw new Error("'options.obj' is not an object");this.obj=e.obj}else this.obj={};var o=function(){};if(this.observer=null,this.onLocalChange=e.onLocalChange,this.onRemoteChange=e.onRemoteChange,this.onPatchReceived=e.onPatchReceived||o,this.onPatchSent=e.onPatchSent||o,this.onSocketStateChanged=e.onSocketStateChanged||o,this.onConnectionError=e.onConnectionError||o,this.retransmissionThreshold=e.retransmissionThreshold||3,this.onReconnectionCountdown=e.onReconnectionCountdown||o,this.onReconnectionEnd=e.onReconnectionEnd||o,this.reconnector=new t(function(){v(this)}.bind(this),this.onReconnectionCountdown,this.onReconnectionEnd),e.pingIntervalS){const p=1e3*e.pingIntervalS;this.heartbeat=new n(this.ping.bind(this),this.handleConnectionError.bind(this),p,p)}else this.heartbeat=new h;this.network=new c(this,e.remoteUrl,e.useWebSocket||!1,this.handleRemoteChange.bind(this),this.onPatchSent.bind(this),this.handleConnectionError.bind(this),this.handleFatalError.bind(this),this.onSocketStateChanged.bind(this)),Object.defineProperty(this,"useWebSocket",{get:function(){return this.network.useWebSocket},set:function(e){this.network.useWebSocket=e}}),this.ignoreCache={},this.ignoreAdd=e.ignoreAdd||null,this.onDataReady=e.callback,e.localVersionPath?e.remoteVersionPath?this.queue=e.ot?new a(s.transform,[e.localVersionPath,e.remoteVersionPath],this.validateAndApplySequence.bind(this),e.purity):new i([e.localVersionPath,e.remoteVersionPath],this.validateAndApplySequence.bind(this),e.purity):this.queue=new r(e.localVersionPath,this.validateAndApplySequence.bind(this),e.purity):this.queue=new l(this.validateAndApplySequence.bind(this)),d(this)}function y(e,t,n,o){if("add"===o&&e.test(n))return t[n]=!0,!0;for(var r=n.split("/"),i="",s=1,a=r.length;s<a;s++)if(i+="/"+r[s],t[i])return!0;return!1}function m(e,t){var n=JSON.stringify(t);e.unobserve(),e.heartbeat.notifySend(),e.network.send(n),e.observe()}var w=function(){};w.prototype={constructor:w,apply:function(e){e.addEventListener=w.prototype.addEventListener,e.hasEventListener=w.prototype.hasEventListener,e.removeEventListener=w.prototype.removeEventListener,e.dispatchEvent=w.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,o=n[e];if(void 0!==o){var r=o.indexOf(t);r!==-1&&o.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var o=[],r=n.length,i=0;i<r;i++)o[i]=n[i];for(var i=0;i<r;i++)o[i].call(this,e)}}}},c.prototype.establish=function(e){p(this,this.remoteUrl.href,null,e)},c.prototype.reestablish=function(e,t){p(this,this.remoteUrl.href+"/reconnect",JSON.stringify(e),t)},c.prototype.send=function(e){var t=this;if(this.useWebSocket&&this._ws&&1===this._ws.readyState)this._ws.send(e),t.onSend(e,t._ws.url,"WS");else{var n=this.remoteUrl.href;this.xhr(n,"application/json-patch+json",e,function(e,o){t.onReceive(e.responseText,n,o)})}return this},c.prototype.onReceive=function(){},c.prototype.onSend=function(){},c.prototype.onStateChange=function(){},c.prototype.upgrade=function(e){},c.prototype.webSocketUpgrade=function(e){var t=this,n=new URL(this.remoteUrl.pathname,this.wsUrl).href;u(t),t._ws=new WebSocket(n),t._ws.onopen=function(o){t.onStateChange(t._ws.readyState,n),e&&e(o)},t._ws.onmessage=function(e){t.onReceive(e.data,t._ws.url,"WS")},t._ws.onerror=function(e){if(t.onStateChange(t._ws.readyState,n,e.data),t.useWebSocket){var o={statusText:"WebSocket connection could not be made.",readyState:t._ws.readyState,url:n};t.onFatalError(o,n,"WS")}},t._ws.onclose=function(e){t.onStateChange(t._ws.readyState,n,null,e.code,e.reason);var o={statusText:"WebSocket connection closed.",readyState:t._ws.readyState,url:n,statusCode:e.code,reason:e.reason};e.reason?t.onFatalError(o,n,"WS"):t.onConnectionError()}},c.prototype.changeState=function(e){var t=this;return this.xhr(e,"application/json-patch+json",null,function(n,o){t.onReceive(n.responseText,e,o)},!0)},c.prototype.setRemoteUrl=function(e){if(this.remoteUrlSet&&this.remoteUrl&&this.remoteUrl!=e)throw new Error("Session lost. Server replied with a different session ID that was already set. \nPossibly a server restart happened while you were working. \nPlease reload the page.\n\nPrevious session ID: "+this.remoteUrl+"\nNew session ID: "+e);this.remoteUrlSet=!0,this.remoteUrl=new URL(e,this.remoteUrl)},c.prototype.handleResponseHeader=function(e){var t=e.getResponseHeader("X-Location")||e.getResponseHeader("Location");t&&this.setRemoteUrl(t)},c.prototype.xhr=function(e,t,n,o,r){var i=this,s=new XMLHttpRequest,a="GET";return s.onload=function(){var t=this;i.handleResponseHeader(t),t.status>=400&&t.status<=599?i.onFatalError({statusCode:t.status,statusText:t.statusText,reason:t.responseText},e,a):o&&o.call(i.palindrom,t,a)},s.onerror=i.onConnectionError.bind(i),n?(a="PATCH",s.open(a,e,!0),s.setRequestHeader("Content-Type","application/json-patch+json")):s.open(a,e,!0),t&&s.setRequestHeader("Accept",t),i.remoteUrl&&r&&s.setRequestHeader("X-Referer",i.remoteUrl.pathname),i.onSend(n,e,a),s.send(n),s},l.prototype.send=function(e){return e},l.prototype.receive=function(e,t){this.apply(e,t)},l.prototype.reset=function(e,t){var n=[{op:"replace",path:"",value:t}];this.apply(e,n)},g.prototype=Object.create(w.prototype);var b=function(e,t){var n;if(ErrorEvent.prototype.initErrorEvent){var o=document.createEvent("ErrorEvent");o.initErrorEvent("error",!0,!0,t.message,"",""),Object.defineProperty(o,"error",{value:t})}else n=new ErrorEvent("error",{bubbles:!0,cancelable:!0,error:t});e.dispatchEvent(n)};if(g.prototype.jsonpatch=o,g.prototype.ping=function(){m(this,[])},g.prototype.observe=function(){this.observer=this.jsonpatch.observe(this.obj,this.filterChangedCallback.bind(this))},g.prototype.unobserve=function(){this.observer&&(this.jsonpatch.unobserve(this.obj,this.observer),this.observer=null)},g.prototype.filterChangedCallback=function(e){this.filterIgnoredPatches(e),e.length&&this.handleLocalChange(e)},g.prototype.filterIgnoredPatches=function(e){if(this.ignoreAdd)for(var t=0,n=e.length;t<n;t++)y(this.ignoreAdd,this.ignoreCache,e[t].path,e[t].op)&&(e.splice(t,1),n--,t--);return e},g.prototype.handleLocalChange=function(e){this.debug&&this.validateSequence(this.remoteObj,e),m(this,this.queue.send(e)),this.onLocalChange&&this.onLocalChange(e)},g.prototype.validateAndApplySequence=function(e,t){this.unobserve();try{var n=this.jsonpatch.apply(e,t,this.debug)}catch(e){if(this.debug)return e.message="Incoming patch validation error: "+e.message,void b(this,e);throw e}var o=this;t.forEach(function(e){if(""===e.path){var n=JSON.stringify(t);n.length>103&&(n=n.substring(0,100)+"..."),o.showWarning("Server pushed patch that replaces the object root",n)}}),this.observe(),this.onRemoteChange&&(console.warn("Palindrom.onRemoteChange is deprecated, please use patch-applied event instead."),this.onRemoteChange(t,n)),this.dispatchEvent(new CustomEvent("patch-applied",{bubbles:!0,cancelable:!0,detail:{patches:t,results:n}}))},g.prototype.validateSequence=function(e,t){var n=this.jsonpatch.validate(t,e);n&&(n.message="Outgoing patch validation error: "+n.message,b(this,n))},g.prototype.handleConnectionError=function(){this.heartbeat.stop(),this.reconnector.triggerReconnection()},g.prototype.handleFatalError=function(e,t,n){this.heartbeat.stop(),this.reconnector.stopReconnecting(),this.onConnectionError&&this.onConnectionError(e,t,n)},g.prototype.reconnectNow=function(){this.reconnector.reconnectNow()},g.prototype.showWarning=function(e,t){this.debug&&console&&console.warn&&(t&&(e+=" ("+t+")"),console.warn("Palindrom warning: "+e))},g.prototype.handleRemoteChange=function(e,t,n){this.heartbeat.notifyReceive();var o=JSON.parse(e||"[]");0!==o.length&&(this.onPatchReceived&&this.onPatchReceived(e,t,n),this.observer&&(this.queue.receive(this.obj,o),this.queue.pending&&this.queue.pending.length&&this.queue.pending.length>this.retransmissionThreshold&&this.queue.pending.forEach(m.bind(null,this)),this.debug&&(this.remoteObj=JSON.parse(JSON.stringify(this.obj)))))},void 0===E)var E=window;return E.Puppet=g,g}();e.exports=h,e.exports.default=h,e.exports.__esModule=!0}).call(t,n(4))}]);